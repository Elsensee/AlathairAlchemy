!function(e){var t="columnizer-original-dom";e.fn.columnize=function(i){function s(e,t){try{e.append(t)}catch(i){e[0].appendChild(t[0])}}this.each(function(){var i=e(this);i.data(t,i.clone(!0,!0))}),this.cols=[],this.offset=0,this.before=[],this.lastOther=0,this.prevMax=0,this.debug=0,this.setColumnStart=null,this.elipsisText="";var n={width:400,columns:!1,buildOnce:!1,overflow:!1,doneFunc:function(){},target:!1,ignoreImageLoading:!0,columnFloat:"left",lastNeverTallest:!1,accuracy:!1,precise:!1,manualBreaks:!1,cssClassPrefix:"",elipsisText:"...",debug:0};return i=e.extend(n,i),"string"==typeof i.width&&(i.width=parseInt(i.width,10),isNaN(i.width)&&(i.width=n.width)),"function"==typeof i.setColumnStart&&(this.setColumnStart=i.setColumnStart),"string"==typeof i.elipsisText&&(this.elipsisText=i.elipsisText),i.debug&&(this.debug=i.debug),i.setWidth||(i.precise?i.setWidth=function(e){return 100/e}:i.setWidth=function(e){return Math.floor(100/e)}),this.each(function(){function t(e,t){var i=t?".":"";return m.length?i+m+"-"+e:i+e}function l(n,l,o,r){for(;(g||o.height()<r)&&l[0].childNodes.length;){var a=l[0].childNodes[0];if(e(a).find(t("columnbreak",!0)).length)return;if(e(a).hasClass(t("columnbreak")))return;s(n,e(a))}if(0!==n[0].childNodes.length){var h=n[0].childNodes,d=h[h.length-1];n[0].removeChild(d);var f=e(d);if(3==f[0].nodeType){var c=f[0].nodeValue,u=i.width/18;i.accuracy&&(u=i.accuracy);for(var m,v=null;o.height()<r&&c.length;){var p=c.indexOf(" ",u);m=-1!=p?c.substring(0,p):c,v=document.createTextNode(m),s(n,e(v)),c=c.length>u&&-1!=p?c.substring(p):""}if(o.height()>=r&&null!==v&&(n[0].removeChild(v),c=v.nodeValue+c),!c.length)return!1;f[0].nodeValue=c}return l.contents().length?l.prepend(f):s(l,f),3==f[0].nodeType}}function o(e,i,n,r){if(!e.contents(":last").find(t("columnbreak",!0)).length&&!e.contents(":last").hasClass(t("columnbreak"))&&i.contents().length){var a=i.contents(":first");if("undefined"==typeof a.get(0)||1!=a.get(0).nodeType)return;var h=a.clone(!0);if(a.hasClass(t("columnbreak")))s(e,h),a.remove();else if(g)s(e,h),a.remove();else if(1==h.get(0).nodeType&&!h.hasClass(t("dontend")))if(s(e,h),h.is("img")&&n.height()<r+20)a.remove();else if(a.hasClass(t("dontsplit"))&&n.height()<r+20)a.remove();else if(h.is("img")||a.hasClass(t("dontsplit")))h.remove();else{if(h.empty(),l(h,a,n,r))a.addClass(t("split"));else{if(a.addClass(t("split")),"OL"==a.get(0).tagName){var d=h.get(0).childElementCount+h.get(0).start;a.attr("start",d+1)}a.children().length&&o(h,a,n,r)}if(0===h.get(0).childNodes.length)h.remove(),a.removeClass(t("split"));else if(1==h.get(0).childNodes.length){var f=h.get(0).childNodes[0];if(3==f.nodeType){var c=/\S/,u=f.nodeValue;c.test(u)||(h.remove(),a.removeClass(t("split")))}}}}}function r(){if(!d.data("columnized")||1!=d.children().length){if(d.data("columnized",!0),d.data("columnizing",!0),d.empty(),d.append(e("<div class='"+t("first")+" "+t("last")+" "+t("column")+" ' style='width:100%; float: "+i.columnFloat+";'></div>")),$col=d.children().eq(d.children().length-1),$destroyable=c.clone(!0),i.overflow){for(targetHeight=i.overflow.height,l($col,$destroyable,$col,targetHeight),$destroyable.contents().find(":first-child").hasClass(t("dontend"))||o($col,$destroyable,$col,targetHeight);$col.contents(":last").length&&a($col.contents(":last").get(0));){var n=$col.contents(":last");n.remove(),$destroyable.prepend(n)}for(var r="",h=document.createElement("DIV");$destroyable[0].childNodes.length>0;){var f=$destroyable[0].childNodes[0];if(f.attributes)for(var u=0;u<f.attributes.length;u++)0===f.attributes[u].nodeName.indexOf("jQuery")&&f.removeAttribute(f.attributes[u].nodeName);h.innerHTML="",h.appendChild($destroyable[0].childNodes[0]),r+=h.innerHTML}var g=e(i.overflow.id)[0];g.innerHTML=r}else s($col,$destroyable.contents());d.data("columnizing",!1),i.overflow&&i.overflow.doneFunc&&i.overflow.doneFunc(),i.doneFunc()}}function a(i){return 3==i.nodeType?/^\s+$/.test(i.nodeValue)&&i.previousSibling?a(i.previousSibling):!1:1!=i.nodeType?!1:e(i).hasClass(t("dontend"))?!0:0===i.childNodes.length?!1:a(i.childNodes[i.childNodes.length-1])}function h(){if(v=0,u!=d.width()){u=d.width();var n=Math.round(d.width()/i.width),h=i.width,m=i.height;if(i.columns&&(n=i.columns),g&&(n=c.find(t("columnbreak",!0)).length+1,h=!1),1>=n)return r();if(!d.data("columnizing")){d.data("columnized",!0),d.data("columnizing",!0),d.empty(),d.append(e("<div style='width:"+i.setWidth(n)+"%; float: "+i.columnFloat+";'></div>")),N=d.children(":last"),s(N,c.clone()),f=N.height(),d.empty();var p=f/n,b=3,y=!1;i.overflow?(b=1,p=i.overflow.height):m&&h&&(b=1,p=m,y=!0);for(var w=0;b>w&&20>w;w++){d.empty();var x,C,N,T;try{x=c.clone(!0)}catch(L){x=c.clone()}x.css("visibility","hidden");for(var $=0;n>$;$++)C=0===$?t("first"):"",C+=" "+t("column"),C=$==n-1?t("last")+" "+C:C,d.append(e("<div class='"+C+"' style='width:"+i.setWidth(n)+"%; float: "+i.columnFloat+";'></div>"));for($=0;$<n-(i.overflow?0:1)||y&&x.contents().length;){for(d.children().length<=$&&d.append(e("<div class='"+C+"' style='width:"+i.setWidth(n)+"%; float: "+i.columnFloat+";'></div>")),N=d.children().eq($),y&&N.width(h+"px"),l(N,x,N,p),o(N,x,N,p);N.contents(":last").length&&a(N.contents(":last").get(0));)T=N.contents(":last"),T.remove(),x.prepend(T);$++,0===N.contents().length&&x.contents().length?N.append(x.contents(":first")):$!=n-(i.overflow?0:1)||i.overflow||x.find(t("columnbreak",!0)).length&&n++}if(i.overflow&&!y){var M=!1,O=document.all&&-1!=navigator.appVersion.indexOf("MSIE 7.");if(M||O){for(var S="",z=document.createElement("DIV");x[0].childNodes.length>0;){var k=x[0].childNodes[0];for($=0;$<k.attributes.length;$++)0===k.attributes[$].nodeName.indexOf("jQuery")&&k.removeAttribute(k.attributes[$].nodeName);z.innerHTML="",z.appendChild(x[0].childNodes[0]),S+=z.innerHTML}var F=e(i.overflow.id)[0];F.innerHTML=S}else e(i.overflow.id).empty().append(x.contents().clone(!0))}else if(y)d.children().each(function(e){N=d.children().eq(e),N.width(h+"px"),0===e?N.addClass(t("first")):e==d.children().length-1?N.addClass(t("last")):(N.removeClass(t("first")),N.removeClass(t("last")))}),d.width(d.children().length*h+"px");else{N=d.children().eq(d.children().length-1),x.contents().each(function(){N.append(e(this))});var H=(N.height(),0),I=1e7,V=0,W=!1,q=0;d.children().each(function(e){return function(i){var s=e.children().eq(i),n=s.children(":last").find(t("columnbreak",!0)).length;if(!n){var l=s.height();W=!1,H+=l,l>V&&(V=l,W=!0),I>l&&(I=l),q++}}}(d));var B=H/q;0===H?w=b:i.lastNeverTallest&&W?(v+=5,p+=30,w==b-1&&b++):V-I>30?p=B+30:Math.abs(B-p)>20?p=B:w=b}d.append(e("<br style='clear:both;'>"))}d.find(t("column",!0)).find(":first"+t("removeiffirst",!0)).remove(),d.find(t("column",!0)).find(":last"+t("removeiflast",!0)).remove(),d.find(t("split",!0)).find(":first"+t("removeiffirst",!0)).remove(),d.find(t("split",!0)).find(":last"+t("removeiflast",!0)).remove(),d.data("columnizing",!1),i.overflow&&i.overflow.doneFunc(),i.doneFunc()}}}var d=e(i.target?i.target:this),f=e(this).height(),c=e("<div></div>"),u=0,g=i.manualBreaks,m=n.cssClassPrefix;"string"==typeof i.cssClassPrefix&&(m=i.cssClassPrefix);var v=0;if(s(c,e(this).contents().clone(!0)),!i.ignoreImageLoading&&!i.target&&!d.data("imageLoaded")&&(d.data("imageLoaded",!0),e(this).find("img").length>0)){var p=function(e,t){return function(){e.data("firstImageLoaded")||(e.data("firstImageLoaded","true"),s(e.empty(),t.children().clone(!0)),e.columnize(i))}}(e(this),c);return e(this).find("img").one("load",p),void e(this).find("img").one("abort",p)}d.empty(),h(),i.buildOnce||e(window).resize(function(){i.buildOnce||(d.data("timeout")&&clearTimeout(d.data("timeout")),d.data("timeout",setTimeout(h,200)))})})},e.fn.uncolumnize=function(){this.each(function(){var i,s=e(this);(i=s.data(t))&&s.replaceWith(i)})},e.fn.renumberByJS=function(t,i,s,n){if(this.setList=function(t,i,s){var n,l=this.before.parents();if(n=e(t[this.offset-1]).find(">*"),n.last()[0].tagName!=s.toUpperCase())return this.debug&&console.log("Last item in previous column, isn't a list..."),0;n=n.length;var o=1;if(o=this.lastOther<=0?this.before.children().length+1:e(l[this.lastOther]).children().length+1,e(t[this.offset]).find(s+":first li.split").length){var r=e(t[this.offset-1]).find(s+":last li:last");if(""===this.elipsisText||e(t[this.offset-1]).find(s+":last ~ div").length||e(t[this.offset-1]).find(s+":last ~ p").length);else if(0==e(r).find("ul, ol, dl").length){var a=r.last().text(),h=a.length;";"==a.substring(h-1)?a.substring(h-4)!=this.elipsisText+";"&&(a=a.substring(0,h-1)+this.elipsisText+";"):a.substring(h-3)!=this.elipsisText&&(a+=this.elipsisText),r.last().text(a)}0==e(t[this.offset]).find(s+":first >li.split >"+s).length&&o--}if(1==n&&(o+=this.prevMax),this.nest>1){this.debug&&console.log("Supposed to be a nested list...decr"),o--;var d=e(t[this.offset-1]).find(s+":first li.split:first");d.length>0&&(this.debug&&console.log("Previous column started with a split item, so that count is one less than expected"),o--),d=e(t[this.offset]).find(s+":first li:first").clone(),d.children().remove(),e.trim(d.text()).length>0&&(this.debug&&console.log("If that was a complete list in the previous column, don't decr."),o++,0==e(t[this.offset-1]).find(">"+s+":last ").children().length&&(this.debug&&console.log("unless that was empty, in which case revert"),o--))}else{var d=e(t[this.offset]).find(s+":first li:first "+s+".split li.split");d.length>0&&(this.debug&&console.log("[Nested] Column started with a split item, so that count is one less than expected"),o--)}return this.debug&&console.log("Setting the start value to "+o+" ("+this.prevMax+")"),o>0&&("function"==typeof this.setColumnStart?this.setColumnStart(i,o):i.attr("start",o)),0},"undefined"==typeof s&&(s=!1),"undefined"==typeof n&&(n=!1),!s&&!n)throw"renumberByJS(): Bad param, must pass an id or a class";var l="";this.prevMax=1,l=n?"."+n:"#"+s;var o=t.toLowerCase(),r=t.toUpperCase();for(this.cols=e(l),this.debug&&console.log("There are "+this.cols.length+" items, looking for "+o),this.before=e(this.cols[0]).find(o+":last"),this.prevMax=this.before.children().length,this.offset=1;this.offset<this.cols.length;this.offset++)if(this.debug&&console.log("iterating "+this.offset+"...[of "+this.cols.length+"]"),this.offset%i!=0){if(this.before=e(this.cols[this.offset-1]).find(o+":last"),this.before.length){this.debug&&console.log("Have some "+t+" elements in the previous column");var a=e(this.cols[this.offset]).find(o+":first"),h=e(this.cols[this.offset]).find("*:first");if(h[0]!==a[0])continue;var d=this.before.parents();this.lastOther=0;for(var f=!1;this.lastOther<d.length;this.lastOther++)if(d[this.lastOther].tagName!=r&&"LI"!=d[this.lastOther].tagName){f=!0,this.lastOther--;break}this.nest=1,e(this.cols[this.offset]).find(">"+o+":first li "+o+":first").length&&(this.nest=2),this.setList(this.cols,a,o),this.lastOther--,a=e(this.cols[this.offset]).find(o+":first li "+o+":first"),a.length&&(this.before=e(this.cols[this.offset-1]).find(">"+o+":last li "+o+":last"),this.prevMax=0,this.nest=1,this.setList(this.cols,a,o));var c=e(this.cols[this.offset-1]).find(">"+o+":last");this.prevMax=c.children().length}}else this.debug&&console.log("First column (in theory..)"),this.prevMax=1;return 0}}(jQuery);
